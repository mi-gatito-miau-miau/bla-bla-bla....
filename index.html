<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3D Adventure Game</title>
<style>
body { margin:0; overflow:hidden; background:black; }
#ui {
  position: fixed;
  top: 10px;
  left: 10px;
  color: white;
  font-family: monospace;
  background: rgba(0,0,0,0.5);
  padding: 10px;
  border-radius: 8px;
}
#inventory {
  display:none;
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.8);
  padding: 10px;
  color: white;
}
#minimap {
  position: fixed;
  top: 10px;
  right: 10px;
  width: 150px;
  height: 150px;
  background: #111;
  border: 2px solid white;
}
</style>
</head>
<body>

<div id="ui">
HP: <span id="hp">100</span><br>
Score: <span id="score">0</span><br>
Stage: <span id="stage">1</span>
</div>

<div id="inventory">ðŸŽ’ Inventory: Sword, Key</div>
<canvas id="minimap"></canvas>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
// ================== SCENE ==================
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x000000, 10, 80);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// ================== LIGHT ==================
const sun = new THREE.DirectionalLight(0xffffff, 1);
sun.position.set(10,20,10);
scene.add(sun);

const ambient = new THREE.AmbientLight(0x404040);
scene.add(ambient);

// ================== PLAYER ==================
const player = {
  hp:100,
  speed:0.15,
  score:0,
  keys:0
};

const playerMesh = new THREE.Mesh(
  new THREE.CapsuleGeometry(0.5,1),
  new THREE.MeshStandardMaterial({color:0x00ffcc})
);
scene.add(playerMesh);
playerMesh.position.y = 1;

camera.position.set(0,2,5);

// ================== WEAPON ==================
const sword = new THREE.Mesh(
  new THREE.BoxGeometry(0.1,1,0.2),
  new THREE.MeshStandardMaterial({color:0xdddddd})
);
sword.position.set(0.5,-0.5,-1);
camera.add(sword);
scene.add(camera);

let attacking = false;
let attackTimer = 0;

// ================== WALLS ==================
const walls = [];
function wall(x,z,w,h){
  const m = new THREE.Mesh(
    new THREE.BoxGeometry(w,3,h),
    new THREE.MeshStandardMaterial({color:0x666666})
  );
  m.position.set(x,1.5,z);
  scene.add(m);
  walls.push(m);
}
wall(0,-10,20,1);
wall(0,10,20,1);
wall(-10,0,1,20);
wall(10,0,1,20);

// ================== ENEMY ==================
const enemies=[];
function spawnEnemy(x,z,isBoss=false){
  const e = new THREE.Mesh(
    new THREE.BoxGeometry(1,2,1),
    new THREE.MeshStandardMaterial({color:isBoss?0xff0000:0x8800ff})
  );
  e.position.set(x,1,z);
  e.hp = isBoss ? 50 : 10;
  e.boss = isBoss;
  scene.add(e);
  enemies.push(e);
}
spawnEnemy(3,3);
spawnEnemy(-4,-3,true);

// ================== INPUT ==================
const keys = {};
onkeydown = e => keys[e.key.toLowerCase()] = true;
onkeyup = e => keys[e.key.toLowerCase()] = false;

onclick = () => attacking = true;

// ================== COLLISION ==================
function collides(pos){
  for(let w of walls){
    if(pos.distanceTo(w.position) < 1.2) return true;
  }
  return false;
}

// ================== LOOP ==================
let dayTime = 0;

function animate(){
  requestAnimationFrame(animate);

  // DAY / NIGHT
  dayTime += 0.001;
  sun.intensity = Math.sin(dayTime)*0.5 + 0.5;

  // MOVE
  let dir = new THREE.Vector3();
  if(keys.w) dir.z -= 1;
  if(keys.s) dir.z += 1;
  if(keys.a) dir.x -= 1;
  if(keys.d) dir.x += 1;
  dir.normalize();

  let nextPos = playerMesh.position.clone().add(dir.multiplyScalar(player.speed));
  if(!collides(nextPos)) playerMesh.position.copy(nextPos);

  camera.position.lerp(
    new THREE.Vector3(
      playerMesh.position.x,
      playerMesh.position.y+1.5,
      playerMesh.position.z+4
    ),0.1
  );
  camera.lookAt(playerMesh.position);

  // ATTACK
  if(attacking){
    attackTimer++;
    sword.rotation.x = -attackTimer*0.2;
    if(attackTimer>5){
      for(let e of enemies){
        if(e.position.distanceTo(playerMesh.position)<2){
          e.hp -= 5;
          if(e.hp<=0){
            scene.remove(e);
            player.score += 100;
          }
        }
      }
    }
    if(attackTimer>10){
      attackTimer=0;
      attacking=false;
      sword.rotation.x=0;
    }
  }

  document.getElementById("hp").innerText = player.hp;
  document.getElementById("score").innerText = player.score;

  renderer.render(scene,camera);
}

animate();
</script>
</body>
</html>
